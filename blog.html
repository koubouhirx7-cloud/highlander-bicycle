<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog | Highlander</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Outfit:wght@400;700&family=Zen+Old+Mincho:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <header class="site-header scrolled">
        <div class="header-container">
            <div class="logo"><a href="index.html"><img src="logo.png" alt="Highlander Logo"></a></div>
            <nav class="main-nav">
                <ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="brand.html">Brand</a></li>
                    <li><a href="service.html">Service</a></li>
                    <li><a href="custom.html">Custom</a></li>
                    <li><a href="rental.html">Rental & Tour</a></li>
                    <li><a href="https://xs001364.xsrv.jp" target="_blank" style="font-weight: 700; color: #d35400;">WEB部</a></li>
                    <li><a href="blog.html" class="active">Blog</a></li>
                    <li><a href="access.html">Access</a></li>
                    <li><a href="shop.html" class="nav-btn">Shop</a></li>
                </ul>
            </nav>
            <div class="mobile-menu-btn"><span></span><span></span><span></span></div>
        </div>
    </header>

    <main class="page-content">
        <section class="page-hero">
            <h1>Blog</h1>
            <p>お店の日常、イベント情報、里山便り。</p>
        </section>

        <section class="section">
            <div class="container">
                <div id="blog-list" class="blog-list" style="max-width: 800px; margin: 0 auto;">
                    <!-- Posts will be loaded here dynamically -->
                </div>
            </div>
        </section>

        <script>
            const API_ENDPOINT = 'https://pnjcsnhgx7.microcms.io/api/v1/blogs';
            const API_KEY = 'izujN0WKzG78ahuntkOZ6JrmA1hje1DL6HTF';

            async function loadBlog() {
                const container = document.getElementById('blog-list');
                container.innerHTML = '<p>記事を読み込んでいます...</p>';

                try {
                    console.log('Fetching from:', API_ENDPOINT);
                    const response = await fetch(API_ENDPOINT, {
                        headers: {
                            'X-MICROCMS-API-KEY': API_KEY
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('Data received:', data);

                    if (!data.contents || !Array.isArray(data.contents)) {
                        throw new Error('データ形式が正しくありません (contentsが見つかりません)');
                    }

                    const posts = data.contents;

                    if (posts.length === 0) {
                        container.innerHTML = '<p>記事がまだありません。</p>';
                        return;
                    }

                    container.innerHTML = posts.map(post => {
                        const date = new Date(post.publishedAt || post.createdAt);
                        const categoryName = post.category ? post.category.name : '未分類';
                        const imageUrl = post.eyecatch ? post.eyecatch.url : null;

                        // Generate a unique ID for each post's toggle
                        const postId = post.id;

                        return `
                            <article class="blog-item"
                                style="background:white; padding:30px; margin-bottom:40px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                                <div class="blog-meta" style="color:#888; font-size:0.9rem; margin-bottom:10px;">
                                    ${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')} | ${categoryName}
                                </div>
                                <h2 style="font-size:1.5rem; margin-bottom:15px; text-align:left; transform:none; left:auto;">
                                    ${post.title}</h2>
                                ${imageUrl ? `<img src="${imageUrl}" style="width:100%; max-width:300px; height:200px; object-fit:cover; border-radius:8px; margin-bottom:15px; box-shadow:var(--shadow-small);">` : ''}
                                
                                <div class="blog-content-wrapper" id="content-${postId}" style="position:relative; max-height: 200px; overflow:hidden; transition: max-height 0.4s ease;">
                                    <div class="blog-content">${post.content}</div>
                                    <div class="fade-overlay" id="fade-${postId}" style="position:absolute; bottom:0; left:0; width:100%; height:80px; background:linear-gradient(rgba(255,255,255,0), white); pointer-events:none;"></div>
                                </div>
                                
                                <div style="text-align:center; margin-top:15px;">
                                    <button onclick="toggleBlog('${postId}')" id="btn-${postId}" 
                                        style="background:none; border:1px solid #333; padding:8px 24px; border-radius:4px; cursor:pointer; font-size:0.9rem; transition:all 0.3s;">
                                        続きを読む
                                    </button>
                                </div>
                            </article>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Error loading blog:', error);
                    container.innerHTML = `<p style="color:red;">読み込みエラー: ${error.message}</p>`;
                }
            }

            // Toggle function for Read More / Close
            window.toggleBlog = function (postId) {
                const content = document.getElementById(`content-${postId}`);
                const fade = document.getElementById(`fade-${postId}`);
                const btn = document.getElementById(`btn-${postId}`);

                if (content.style.maxHeight !== 'none') {
                    // Open
                    content.style.maxHeight = 'none';
                    fade.style.display = 'none';
                    btn.innerText = '閉じる';
                } else {
                    // Close
                    content.style.maxHeight = '200px';
                    fade.style.display = 'block';
                    btn.innerText = '続きを読む';
                    // Optional: Scroll back to top of article if needed
                    // content.scrollIntoView({behavior: "smooth", block: "center"}); 
                }
            }

            window.onload = loadBlog;
        </script>
    </main>

    <footer class="site-footer">
        <div class="container" style="margin-bottom: 20px;"><a href="brand.html"
                style="color: rgba(255,255,255,0.7); text-decoration: none; margin: 0 10px; font-size: 0.9rem;">Brand
                List</a> | <a href="https://kokyaku-kanri.pages.dev/booking" target="_blank"
                style="color: rgba(255,255,255,0.7); text-decoration: none; margin: 0 10px; font-size: 0.9rem;">Booking</a>
        </div>
        <p>&copy; 2026 Highlander Bicycle Shop</p>
    </footer>
</body>

</html>